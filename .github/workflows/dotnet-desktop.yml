name: Build and Release

on:
  release:
    types: [published]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4

    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '9.0.x'

    - name: Restore dependencies
      run: dotnet restore ${{ env.PROJECT_PATH }}
      env:
        PROJECT_PATH: OnScreen-GIF-WPF/OnScreen-GIF-WPF.csproj

    - name: Publish single-file (Release)
      run: |
        dotnet publish ${{ env.PROJECT_PATH }} `
          -c Release `
          -r ${{ env.RUNTIME }} `
          -f ${{ env.TARGET_FRAMEWORK }} `
          -p:PublishSingleFile=true `
          -p:SelfContained=${{ env.SELF_CONTAINED }} `
          -p:PublishTrimmed=false `
          -o ./publish
      shell: pwsh
      env:
        PROJECT_PATH: OnScreen-GIF-WPF.csproj
        RUNTIME: win-x64
        TARGET_FRAMEWORK: net9.0-windows
        SELF_CONTAINED: true

    - name: Upload release asset
      id: upload-release-asset
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ github.event.release.upload_url }}
        asset_path: ./publish/OnScreen-GIF-WPF.exe    # укажите точный файл или архив
        asset_name: OnScreen-GIF-WPF.exe
        asset_content_type: application/octet-stream
